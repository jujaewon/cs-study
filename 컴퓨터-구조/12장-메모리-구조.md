### 메모리 계층 (Memory Hierachy)

컴퓨터 시스템의 메모리 계층
    1. Registers
    2. Level-1 Cache
    3. Level-2,3 Cache
    4. Main Memory
    5. Disk(SSD/HDD/RAID)
    6. Backup Storage(Tape,Drum)

버스 인터페이스(2020년 기준)
- 내부 버스로 연결
    - Register, Caches
- 외부 버스로 연결
    - Main Memory
- 입출력 버스로 연결
    - Disk, Backup Storages

### 주 기억 장치 (Main Memory)

정의
- 컴퓨터가 동작하는 동안 데이터와 프로그램을 저장
- 고속의 저장 장치(메모리 상위 계층)
- RAM과 ROM을 합친 개념

RAM
- MOSFET binary refrech cell로 구성
- 실행 가능한 프로그램을 저장
- Turing Machine의 기억 장치에 해당

ROM
- EPROM, Flash RAM으로 구성
- BIOS, Bootstrap code 저장

모듈 RAM의 구성
- 4~8개의 RAM 칩으로 구성
- 소용량 RAM -> 대용량 RAM
- 용량에 따라서 사용 주소 bit 변동
    - 1MB(128K*8)   :20bit(17bit)
    - 4GB(512M*8)   :32bit(29bit)
    - 16GB(2G*8)    :34bit(31bit)

일반 DRAM 구성
- DRAM 칩(IC)
    - 듀얼 인라인 패키지(DIP)
- DRAM 메모리 모듈
    - 싱글 인라인 패키지(SIPP)
    - 싱글 인라인 메모리 모듈(SIMM)
    - 듀얼 인라인 메모리 모듈(DIMM)
    - 램버스 인라인 메모리 모듈(RIMM)
        - 기술적으로 DIMM이지만 특허 슬롯 때문에 RIMM으로 불린다.
    - 소형 설계 DIMM(SO-DIMM)
        - 노트북, 푸트프린트 PC, 업그레이드 가능 프린터, 라우터 등에 쓰임
            - 72핀(32QLXM), 144핀(64비트), 200핀(72비트)
    - 소형 설계 RIMM(SO-RIMM)
        - RIMM의 소형 버전
        - 기술적으로 SO-DIMM이지만 특허 슬롯 떄문에 SO-RIMM로 불린다.

일반 DRAM 모듈
- DIP 16핀(DRAM 칩, 보통 FPRAM 이전)
- SIPP(FPRAM)
- SIMM 30핀(FPRAM)
- SIMM 72핀(EDO RAM)
- DIMM 168핀(SDRAM)
- DIMM 184핀(DDR SDRAM)
- DIMM 240핀(DDR2 SDRAM/DDR3 SDRAM)

### 보조 기억 장치 (Auxiliary Memory)

자기 디스크(Magnetic Disks)
    - Winchester type
        - Hard disk / Pack disk
    - Floppy type
    - Optical type
        - MO / CD-ROM / DVD

자기 테이프(Magnetic Tape)
    - Reel type
    - Cartridge type
        - 8mm / 6mm DAT

자기 디스크의 구성
- Platter 
    - Cylinder / Track / Sector
- Spindle
    - Long-term rotation Motor
- Head/Arm(Actuator)
    - Data read, write
    - Voice coil로 구동, sector tracking
- Controller 
    - Mechanical control + bus control
    - CPU, RAM을 포함하는 자체 컴퓨터

디스크 용량
- Capacity = Sector수(512KB) x Track수(N) x Head수(2~4)
- 1TB disk = 1,099,512MB = 0.512 x 536,870,912,000 x 4

디스크 성능
- Access Time = Seek Time + Rotational Delay + Transfer Time

자기 테이프
- 7~9bit 동시 기록 -> 1 record
- Reel type 또는 cartridge type
- 최근에 DAT로 이전
- RAID에 의하여 대체 중

RAID(Redundant Array of Independent Disks)
- 다수의 HDD, 또는 SSD를 이용한 대용량 병렬 저장 장치
- Level에 따른 구조 및 기능 분류

RAID 0: Striping
RAID 1: Mirroring
RAID 2: Hamming Code
RAID 3: Bit Striping
RAID 4: Block Striping
RAID 5: Rotated Stripping
RAID 6: Dual Striped Parity

### 어소시어티브 메모리 (Associative Memory)

Main Memory : 주소 기반의 데이터 검색
Associative Memory : 내용 기반의 데이터 검색

### 캐시 메모리 (Cache Memory)

특성
- Main memory보다 10~100배 빠른 접근 속도
- 주 기억 장치보다 작은 용량
- Level에 따른 계층적 구조
    - CPU내에 위치 : Level-1, Level-2
    - CPU내/외부에 위치 : Level-3(AMD 제외)

주소 매핑(Address Mapping)
- 주 기억장치 주소 공간과 캐쉬 주소 공간과의 연결
- 매핑 방식
    - 어소시어티브 매핑(Associative mapping)
    - 직접매핑(Direct mapping)
    - 세트 어소시어티브 매핑(Set associative mapping)

어소시어티브 매핑
- 캐시를 Address와 Data 공간으로 분할
- 데이터 저장시에 Address와 Data 모두 저장
- CPU address를 캐쉬의 address와 비교(Argument register 사용)

캐시 데이터의 접근
- Match Logic에 의하여 데이터 Match : Cache Hit
    -> Data 부분을 접근하여 CPU로 전달
- Match Logic에서 Match 없을 시 : Cache Miss
    -> Main memory를 접근

직접 매핑
- CPU 주소의 일부를 캐시 주소로 사용
- 메모리 주소를 Tag와 Index로 구분
- Index 값으로 캐쉬 접근

블록을 가지는 직접 매핑
- Index를 block과 word로 구분
- 같은 block내에서는 tag 값 사용
- Index 값으로 캐쉬 접근

세트 어소시어티브 매핑
- 동일한 Index에 2개 이상의 Tag 저장
- 2-way / 4-way associative
- Tag 수만큼 set이 있을 경우
    -> Fully-associative mapping

캐시에 기록
- CPU 데이터를 메모리와 캐시에 저장하는 구조
- Write-through
    - 캐시와 메모리에 동시에 저장
    - 쓰기 속도 느림, system crash 발생시에 데이터 안정성 높음
- Write-back
    - 캐시에 먼저 저장, 이후 버스 유휴 시간에 메모리로 기록
    - 쓰기 속도 빠름, system crash 발생시에 데이터 손상 가능성 높음

캐시 힛트율(Hit ratio)
- CPU가 접근하는 데이터가 캐시에서 먼저 접근될 확률
- 일반적인 경우 85%~95%
- 캐시 미스율(Miss ratio)로 나타내기도 함

캐시 초기값 설정
- 캐시 데이터 무효화 -> Valid bit를 사용
- 초기값 설정 <- 모든 Valid bit를 0으로 set

### 가상 메모리 (Virtual Memory)

개념
- 사용자에게 보조 메모리의 총량에 해당하는 대형 주소 공간을 제공

주소 공간과 메모리 공간
- 가상주소(Virtual address) : 프로그래머에 의하여 쓰여진 주소
- 주소공간(Address space) : 가상주소로 이루어진 공간
- 물리주소(Physical address) : 주기억 장치의 주소
- 메모리공간(Memory space) : 물리 주소로 이루어진 공간

주소 매핑
- 가상 주소를 물리 주소로 연결하는 방법(CPU는 가상주소만 사용)

페이지를 사용하는 주소 매핑
- 페이지 : 일정 크기의 주소 공간 단위
- 페이지 크기
    - Windows : 64KB
    - Unix : 1KB
- 블록 : 페이지 크기의 메모리 공간 단위
- 페이지 테이블 : 메모리에 생성, 접근

어소시어티브 메모리 페이지표
- 가상주소-물리주소 매핑에 어소시어티브 메모리 사용
- 빠른 주소 변환 가능
- 가상주소의 페이지번호를 직접 검색하여 블록 매핑

페이지 교체
- 페이지 교체 시기
    - 블록들이 모두 사용중이면서 새로운 페이지가 필요할 때
    - CPU가 참조하는 페이지에 해당하는 블록이 없을 때
        -> 페이지 결함(Page fault)
    - 페이지 결함 발생시 I/O 인터럽트 통하여 필요한 페이지를 보조 기억 장치로부터 업로드
- 페이지 교체 전략
    - FIFO : 가장 먼저 들어온 페이지를 먼저 교체
    - LRU : 최근에 가장 적게 참조된 페이지를 교체
        - 직전에 들어온 페이지를 교체할 위험성 내포
        - LRU with age register : 수명 레지스터를 사용
    - LFU : 최근에 가장 많이 참조된 페이지를 교체

### 메모리 관리 하드웨어 (Memory Management Hardware)

메모리 관리 하드웨어(Memory Management Unit: MMU)
- 기본적인 역할
    1. 논리 메모리 참조를 물리 메모리 주소로 변환, 동적 저장 장소 재배치
    2. 메모리 내에 서로 다른 사용자들이 하나의 프로그램을 공유하도록 지원
    3. 사용자의 허가되지 않은 접근 방지
    4. 사용자가 운영체제의 기능을 변경하지 못하도록 정보를 보호
- 동적 저장 장소 재배치(Dynamic Memory Relocation)
    - 가상 메모리 시스템에서 페이지 크기를 가변적으로 운영 -> 세그먼트
    - 프로그램의 크기나 논리 구조의 용이성 제공
    - 필요한 페이지를 메모리 공간에 이동, 병합
- 세그먼트(segment)
    - 프로그램과 데이터를 세그먼트로 구분
    - 여러 개의 페이지로 이루어지는 논리 공간
    - 논리 주소 : 세그먼트로 된 프로그램에 의하여 지정되는 주소
- 멀티프로그래밍 시스템
    - 여러 사용자들간의 프로그램 세그먼트의 공유(ex: OS 프로그램, 유틸리티 등)
    - 논리 주소의 범위를 공유

세그먼트 내의 페이지 매핑 예
- 20bit 논리 주소 -> 20bit 물리 주소로 변환
- 256 words in a page
- 256 pages in a segment

메모리의 보호
- 보호 모드에서의 메모리 관리
    - 보호 모드(Protected Mode)에서 메모리 접근 권한 제어
    - 다중 사용자, 멀티프로그래밍 환경에 필수
    - 세그먼트 단위의 접근 권한을 제어
- 세그먼트 설명자
    Base address Length Protection
- 접근 권한의 종류
    - Full read and write(Privilege)
    - Read only(write protection)
    - Execute only(program protection)
    - System only(operating system protection)